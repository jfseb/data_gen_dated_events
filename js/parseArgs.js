"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.GeneratePersons = exports.GetParams1 = exports.makeSeedRandom = exports.SeedRandomWrap = exports.dumpUserHierarchyIfRequested = exports.getOutputParams = exports.OutputParams = exports.parseArguments = exports.ParsedArgs = void 0;
const Helpers = require("./helpers");
const { exit } = require('process');
const argparse_1 = require("argparse");
const { version } = require('../package.json');
const core_1 = require("@js-joda/core");
const seedrandom = require("seedrandom");
class ParsedArgs {
}
exports.ParsedArgs = ParsedArgs;
function parseArguments(explicitArgs) {
    const parser = new argparse_1.ArgumentParser({
        description: "date_gen_dated_events, generate HR data"
    });
    parser.add_argument('-v', '--version', { action: 'version', version });
    parser.add_argument('-n', '--nrpersons', { action: 'store', type: "int", help: 'Number of persons', default: 2 });
    parser.add_argument('-z', '--zero', { action: 'store_true', help: 'write zero lines ( one record each month) .Z. ' });
    parser.add_argument('-s', '--stopRecords', { action: 'store_true', help: 'write stop records, default extension .S. ' });
    parser.add_argument('-a', '--addSamples', { action: 'store_true', help: 'adds fixed samples from input folder to files' });
    parser.add_argument('-o', '--output', { action: 'store', help: 'output prefix, default MONAG_<nrpers>.Z.csv , RANGE_<nrpers>.xx' });
    parser.add_argument('-p', '--period', { action: 'store', type: "int", default: 150, help: 'Event period write zero lines ( one reacord each month) .Z. ' });
    parser.add_argument('-u', '--userHierarchy', { action: 'store_true', help: 'generate hierarchy for nrpersons (DIM_USER_<xxxx>.csv) ' });
    var args = parser.parse_args(explicitArgs ? explicitArgs.split(' ') : undefined);
    //console.log(JSON.stringify(args));
    return JSON.parse(JSON.stringify(args));
}
exports.parseArguments = parseArguments;
class OutputParams {
}
exports.OutputParams = OutputParams;
function getOutputParams(args) {
    var o = new OutputParams();
    var BASEFILENAME = args.output || '';
    if (BASEFILENAME.length && !BASEFILENAME.endsWith('_')) {
        BASEFILENAME += '_';
    }
    o.AVG_NEXT = args.period;
    var SUFFIX = Helpers.padZeros(o.AVG_NEXT, 4) + '_' + Helpers.padZeros(args.nrpersons, 6);
    o.NOZERO = !args.zero;
    o.STOPRECORDs = args.stopRecords;
    var ext = "." + (o.NOZERO ? "" : "Z.") + (o.STOPRECORDs ? "S." : "") + "csv";
    var extc = "." + (o.NOZERO ? "" : "Z.") + (o.STOPRECORDs ? "S." : "") + "C.csv";
    o.FILENAME_MONAG = BASEFILENAME + "MONAG_" + SUFFIX + ext;
    o.FILENAME_MONAG_C = BASEFILENAME + "MONAG_" + SUFFIX + extc;
    o.FILENAME_RANGE = BASEFILENAME + "RANGE_" + SUFFIX + ext;
    o.FILENAME_RANGE_C = BASEFILENAME + "RANGE_" + SUFFIX + extc;
    return o;
}
exports.getOutputParams = getOutputParams;
function dumpUserHierarchyIfRequested(args) {
    if (args.userHierarchy) {
        Helpers.genUSERHierarchy(args.nrpersons);
    }
}
exports.dumpUserHierarchyIfRequested = dumpUserHierarchyIfRequested;
class SeedRandomWrap {
    constructor(s) {
        this.sr = seedrandom(s);
    }
    random() {
        this._last = this.sr.random();
        return this._last;
    }
    otherRandom(i) {
        var base = 100;
        for (var k = 0; k < i; ++i) {
            base *= 10;
        }
        var b = this._last * base;
        var u = b - Math.floor(this._last * base);
        return u;
    }
}
exports.SeedRandomWrap = SeedRandomWrap;
;
function makeSeedRandom(s) {
    return new SeedRandomWrap(s);
}
exports.makeSeedRandom = makeSeedRandom;
function GetParams1(args) {
    var d1 = core_1.LocalDate.of(2020, 1, 6);
    var d2 = core_1.LocalDate.of(2024, 6, 1);
    var LOCATION_VALUES = { "NewYork": 5,
        "LA": 5,
        "Chicago": 5,
        "Berlin": 2,
        "Frankfurt": 2,
        "Bangalore": 2,
        "SFO": 1
    };
    var ESTAT_VALUES = {
        "A": 4,
        "U": 1,
        "P": 1,
        "S": 2,
    };
    console.log(args);
    var pars = {
        NRPERS: args.nrpersons,
        AVG_NEXT: args.period,
        LOCCHANGE: 0.5,
        FTECHANGE: 0.5,
        ESTATCHANGE: 0.8,
        L_EVENT: 0.7,
        L_HIRE: 0.5,
        LOCATIONs: Helpers.makeMap(LOCATION_VALUES),
        ESTATs: Helpers.makeMap(ESTAT_VALUES),
        firstDate: d1,
        lastDate: d2,
        random: seedrandom('abc'),
        randomOD: { "ESTAT": seedrandom('XZY') },
        REOP_ESTATS: ["A", "U", "P"],
        wsMONAG: undefined,
        wsRANGE: undefined,
        optsMONAG: {
            noZero: !args.zero,
            stopRecords: args.stopRecords
        }
    };
    return pars;
}
exports.GetParams1 = GetParams1;
function GeneratePersons(pars, o) {
    pars.wsMONAG = Helpers.getWS(o.FILENAME_MONAG);
    pars.wsRANGE = Helpers.getWS(o.FILENAME_RANGE);
    Helpers.writeHeader(pars.wsMONAG);
    Helpers.writeHeader(pars.wsRANGE);
    for (var p = 1; p < pars.NRPERS; ++p) {
        var pn = Helpers.genUser(p);
        Helpers.genPerson(pn, pars);
    }
    pars.wsMONAG.ws.on('finish', () => {
        console.log('Wrote data to file ' + o.FILENAME_MONAG);
        Helpers.cleanseWSCommentsRepeatedHeaderInFile(o.FILENAME_MONAG, o.FILENAME_MONAG_C, function () {
            console.log('Wrote cleansed file to ' + o.FILENAME_MONAG_C);
        });
    });
    pars.wsRANGE.ws.on('finish', () => {
        console.log('Wrote data to file ' + o.FILENAME_RANGE);
        Helpers.cleanseWSCommentsRepeatedHeaderInFile(o.FILENAME_RANGE, o.FILENAME_RANGE_C, function () {
            console.log('Wrote cleansed file to ' + o.FILENAME_RANGE_C);
        });
    });
    pars.wsMONAG.ws.end();
    pars.wsRANGE.ws.end();
}
exports.GeneratePersons = GeneratePersons;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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LENBQUMsQ0FBQyxDQUFDO0lBQ0gsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUU7UUFDakMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsR0FBRyxDQUFDLENBQUMsY0FBYyxDQUFFLENBQUM7UUFDdkQsT0FBTyxDQUFDLHFDQUFxQyxDQUFDLENBQUMsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxDQUFDLGdCQUFnQixFQUFFO1lBQ25GLE9BQU8sQ0FBQyxHQUFHLENBQUMseUJBQXlCLEdBQUcsQ0FBQyxDQUFDLGdCQUFnQixDQUFFLENBQUM7UUFDOUQsQ0FBQyxDQUFDLENBQUM7SUFDSixDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDO0lBQ3RCLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDO0FBQ3ZCLENBQUM7QUF6QkQsMENBeUJDIiwiZmlsZSI6InBhcnNlQXJncy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcclxuaW1wb3J0ICogYXMgSGVscGVycyBmcm9tICcuL2hlbHBlcnMnO1xyXG5cclxuY29uc3QgeyBleGl0IH0gPSByZXF1aXJlKCdwcm9jZXNzJyk7XHJcblxyXG5pbXBvcnQgeyBBcmd1bWVudFBhcnNlciB9IGZyb20gJ2FyZ3BhcnNlJztcclxuY29uc3QgeyB2ZXJzaW9uIH0gPSByZXF1aXJlKCcuLi9wYWNrYWdlLmpzb24nKTtcclxuXHJcbmltcG9ydCB7TG9jYWxEYXRlIH0gZnJvbSAgXCJAanMtam9kYS9jb3JlXCI7XHJcblxyXG5pbXBvcnQgKiBhcyBzZWVkcmFuZG9tIGZyb20gJ3NlZWRyYW5kb20nO1xyXG5cclxuZXhwb3J0IGNsYXNzIFBhcnNlZEFyZ3Mge1xyXG5cdG5ycGVyc29ucyA6IG51bWJlcjtcclxuXHR6ZXJvIDogYm9vbGVhbjtcclxuXHRzdG9wUmVjb3JkcyA6IGJvb2xlYW47XHJcblx0b3V0cHV0IDogc3RyaW5nO1xyXG5cdHBlcmlvZCA6IG51bWJlcjtcclxuXHR1c2VySGllcmFyY2h5IDogYm9vbGVhbjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlQXJndW1lbnRzKGV4cGxpY2l0QXJncyA6IHN0cmluZykge1xyXG5cdGNvbnN0IHBhcnNlciA9IG5ldyBBcmd1bWVudFBhcnNlcigge1xyXG5cdGRlc2NyaXB0aW9uOiBcImRhdGVfZ2VuX2RhdGVkX2V2ZW50cywgZ2VuZXJhdGUgSFIgZGF0YVwiXHJcblx0fSk7XHJcblx0cGFyc2VyLmFkZF9hcmd1bWVudCgnLXYnLCAnLS12ZXJzaW9uJywgeyBhY3Rpb246ICd2ZXJzaW9uJywgdmVyc2lvbiB9KTtcclxuXHRwYXJzZXIuYWRkX2FyZ3VtZW50KCctbicsICctLW5ycGVyc29ucycsIHsgYWN0aW9uIDogJ3N0b3JlJywgdHlwZTogXCJpbnRcIiwgaGVscDogJ051bWJlciBvZiBwZXJzb25zJyAsIGRlZmF1bHQ6IDIgfSk7XHJcblx0cGFyc2VyLmFkZF9hcmd1bWVudCgnLXonLCAnLS16ZXJvJywgeyBhY3Rpb246ICdzdG9yZV90cnVlJywgIGhlbHA6ICd3cml0ZSB6ZXJvIGxpbmVzICggb25lIHJlY29yZCBlYWNoIG1vbnRoKSAuWi4gJyB9KTtcclxuXHRwYXJzZXIuYWRkX2FyZ3VtZW50KCctcycsICctLXN0b3BSZWNvcmRzJywgeyBhY3Rpb246ICdzdG9yZV90cnVlJywgaGVscDogJ3dyaXRlIHN0b3AgcmVjb3JkcywgZGVmYXVsdCBleHRlbnNpb24gLlMuICcgfSk7XHJcblx0cGFyc2VyLmFkZF9hcmd1bWVudCgnLWEnLCAnLS1hZGRTYW1wbGVzJywgeyBhY3Rpb246ICdzdG9yZV90cnVlJywgaGVscDogJ2FkZHMgZml4ZWQgc2FtcGxlcyBmcm9tIGlucHV0IGZvbGRlciB0byBmaWxlcycgfSk7XHJcblx0cGFyc2VyLmFkZF9hcmd1bWVudCgnLW8nLCAnLS1vdXRwdXQnLCB7IGFjdGlvbiA6ICdzdG9yZScsIGhlbHA6ICdvdXRwdXQgcHJlZml4LCBkZWZhdWx0IE1PTkFHXzxucnBlcnM+LlouY3N2ICwgUkFOR0VfPG5ycGVycz4ueHgnIH0pO1xyXG5cdHBhcnNlci5hZGRfYXJndW1lbnQoJy1wJywgJy0tcGVyaW9kJywgeyBhY3Rpb246ICdzdG9yZScsIHR5cGU6IFwiaW50XCIsIGRlZmF1bHQgOiAxNTAsICBoZWxwOiAnRXZlbnQgcGVyaW9kIHdyaXRlIHplcm8gbGluZXMgKCBvbmUgcmVhY29yZCBlYWNoIG1vbnRoKSAuWi4gJyB9KTtcclxuXHRwYXJzZXIuYWRkX2FyZ3VtZW50KCctdScsICctLXVzZXJIaWVyYXJjaHknLCB7IGFjdGlvbjogJ3N0b3JlX3RydWUnLCBoZWxwOiAnZ2VuZXJhdGUgaGllcmFyY2h5IGZvciBucnBlcnNvbnMgKERJTV9VU0VSXzx4eHh4Pi5jc3YpICcgfSk7XHJcblxyXG5cdHZhciBhcmdzID0gcGFyc2VyLnBhcnNlX2FyZ3MoIGV4cGxpY2l0QXJncz8gZXhwbGljaXRBcmdzLnNwbGl0KCcgJykgIDogdW5kZWZpbmVkKTtcclxuXHJcblx0Ly9jb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShhcmdzKSk7XHJcblx0cmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoYXJncykpIGFzIFBhcnNlZEFyZ3M7XHJcbn1cclxuXHJcblxyXG5leHBvcnQgY2xhc3MgT3V0cHV0UGFyYW1zIHtcclxuXHROUlBFUlMgOiBzdHJpbmc7XHJcblx0QVZHX05FWFQgOiBudW1iZXI7XHJcblx0RklMRU5BTUVfTU9OQUcgOiBzdHJpbmc7XHJcblx0RklMRU5BTUVfTU9OQUdfQyA6IHN0cmluZztcclxuXHRGSUxFTkFNRV9SQU5HRSA6IHN0cmluZztcclxuXHRGSUxFTkFNRV9SQU5HRV9DIDogc3RyaW5nO1xyXG5cdE5PWkVSTyA6IGJvb2xlYW47XHJcblx0U1RPUFJFQ09SRHM6IGJvb2xlYW47XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRPdXRwdXRQYXJhbXMoIGFyZ3M6IFBhcnNlZEFyZ3MgKSB7XHJcblxyXG5cdHZhciBvID0gbmV3IE91dHB1dFBhcmFtcygpO1xyXG5cdHZhciBCQVNFRklMRU5BTUUgPSBhcmdzLm91dHB1dCB8fCAnJztcclxuXHRpZiAoIEJBU0VGSUxFTkFNRS5sZW5ndGggJiYgIUJBU0VGSUxFTkFNRS5lbmRzV2l0aCgnXycpKSB7XHJcblx0XHRCQVNFRklMRU5BTUUgKz0gJ18nO1xyXG5cdH1cclxuXHJcblx0by5BVkdfTkVYVCA9IGFyZ3MucGVyaW9kO1xyXG5cclxuXHR2YXIgU1VGRklYID0gSGVscGVycy5wYWRaZXJvcyhvLkFWR19ORVhULDQpICsgJ18nICArIEhlbHBlcnMucGFkWmVyb3MoYXJncy5ucnBlcnNvbnMsNilcclxuXHJcblx0by5OT1pFUk8gPSAhYXJncy56ZXJvO1xyXG5cdG8uU1RPUFJFQ09SRHMgPSBhcmdzLnN0b3BSZWNvcmRzO1xyXG5cclxuXHR2YXIgZXh0ID0gXCIuXCIgKyAoby5OT1pFUk8gPyBcIlwiIDogIFwiWi5cIikgICsgICAoby5TVE9QUkVDT1JEcyA/IFwiUy5cIiA6IFwiXCIpICsgXCJjc3ZcIjtcclxuXHR2YXIgZXh0YyA9IFwiLlwiICsgKG8uTk9aRVJPID8gXCJcIiA6ICBcIlouXCIpICArICAgKG8uU1RPUFJFQ09SRHMgPyBcIlMuXCIgOiBcIlwiKSArIFwiQy5jc3ZcIjtcclxuXHJcblx0by5GSUxFTkFNRV9NT05BRyA9IEJBU0VGSUxFTkFNRSArIFwiTU9OQUdfXCIgKyAgU1VGRklYICsgIGV4dDtcclxuXHRvLkZJTEVOQU1FX01PTkFHX0MgPSBCQVNFRklMRU5BTUUgKyBcIk1PTkFHX1wiICsgIFNVRkZJWCArICBleHRjO1xyXG5cdG8uRklMRU5BTUVfUkFOR0UgPSBCQVNFRklMRU5BTUUgKyBcIlJBTkdFX1wiICsgIFNVRkZJWCArICBleHQ7XHJcblx0by5GSUxFTkFNRV9SQU5HRV9DID0gQkFTRUZJTEVOQU1FICsgXCJSQU5HRV9cIiArICBTVUZGSVggKyAgZXh0YztcclxuXHRyZXR1cm4gbztcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGR1bXBVc2VySGllcmFyY2h5SWZSZXF1ZXN0ZWQoYXJnczogUGFyc2VkQXJncyApIHtcclxuXHRpZiAoIGFyZ3MudXNlckhpZXJhcmNoeSApIHtcclxuXHRcdEhlbHBlcnMuZ2VuVVNFUkhpZXJhcmNoeShhcmdzLm5ycGVyc29ucyk7XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgU2VlZFJhbmRvbVdyYXAge1xyXG5cdHNyIDogYW55O1xyXG5cdF9sYXN0IDogbnVtYmVyO1xyXG5cdGNvbnN0cnVjdG9yKHM6c3RyaW5nKSB7XHJcblx0XHR0aGlzLnNyID0gc2VlZHJhbmRvbShzKVxyXG5cdH1cclxuXHRyYW5kb20oKSA6IG51bWJlciB7XHJcblx0XHR0aGlzLl9sYXN0ID0gdGhpcy5zci5yYW5kb20oKTtcclxuXHRcdHJldHVybiB0aGlzLl9sYXN0O1xyXG5cdH1cclxuXHRvdGhlclJhbmRvbShpIDogbnVtYmVyKSA6IG51bWJlciB7XHJcblx0XHR2YXIgYmFzZSA9IDEwMDtcclxuXHRcdGZvcih2YXIgayA9IDA7IGsgPCBpOyArK2kpIHtcclxuXHRcdFx0YmFzZSAqPSAxMDtcclxuXHRcdH1cclxuXHRcdHZhciBiID0gdGhpcy5fbGFzdCAqIGJhc2U7XHJcblx0XHR2YXIgdSA9IGIgLSBNYXRoLmZsb29yKHRoaXMuX2xhc3QgKiBiYXNlKTtcclxuXHRcdHJldHVybiB1O1xyXG5cdH1cclxufTtcclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gbWFrZVNlZWRSYW5kb20ocyA6IHN0cmluZykge1xyXG5cdHJldHVybiBuZXcgU2VlZFJhbmRvbVdyYXAocyk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBHZXRQYXJhbXMxKGFyZ3M6IFBhcnNlZEFyZ3MpIDogSGVscGVycy5HZW5QYXJhbXMge1xyXG5cdHZhciBkMSA9IExvY2FsRGF0ZS5vZigyMDIwLDEsNik7XHJcblx0dmFyIGQyID0gTG9jYWxEYXRlLm9mKDIwMjQsNiwxKTtcclxuXHJcblx0dmFyIExPQ0FUSU9OX1ZBTFVFUyA9IHsgXCJOZXdZb3JrXCIgOiA1LFxyXG5cdFwiTEFcIiA6IDUsXHJcblx0XCJDaGljYWdvXCIgOiA1LFxyXG5cdFwiQmVybGluXCIgOiAyLFxyXG5cdFwiRnJhbmtmdXJ0XCIgOiAyLFxyXG5cdFwiQmFuZ2Fsb3JlXCIgOiAgMixcclxuXHRcIlNGT1wiIDogMVxyXG5cdH07XHJcblxyXG5cdHZhciBFU1RBVF9WQUxVRVMgPSB7XHJcblx0XCJBXCIgOiA0LFxyXG5cdFwiVVwiIDogMSxcclxuXHRcIlBcIiA6IDEsXHJcblx0XCJTXCIgOiAyLFxyXG5cdH07XHJcblx0Y29uc29sZS5sb2coYXJncyk7XHJcblxyXG5cdHZhciBwYXJzID0ge1xyXG5cdE5SUEVSUyA6IGFyZ3MubnJwZXJzb25zLFxyXG5cdEFWR19ORVhUIDogYXJncy5wZXJpb2QsXHJcblx0TE9DQ0hBTkdFIDogMC41LFxyXG5cdEZURUNIQU5HRSA6IDAuNSxcclxuXHRFU1RBVENIQU5HRSA6IDAuOCxcclxuXHRMX0VWRU5UIDogMC43LFxyXG5cdExfSElSRSA6IDAuNSxcclxuXHRMT0NBVElPTnMgOiBIZWxwZXJzLm1ha2VNYXAoTE9DQVRJT05fVkFMVUVTKSxcclxuXHRFU1RBVHMgOiBIZWxwZXJzLm1ha2VNYXAoRVNUQVRfVkFMVUVTKSxcclxuXHRmaXJzdERhdGUgOiBkMSxcclxuXHRsYXN0RGF0ZSAgOiBkMixcclxuXHRyYW5kb20gOiBzZWVkcmFuZG9tKCdhYmMnKSxcclxuXHRyYW5kb21PRCA6IHsgXCJFU1RBVFwiIDogc2VlZHJhbmRvbSgnWFpZJykgfSxcclxuXHRSRU9QX0VTVEFUUyA6ICBbXCJBXCIsXCJVXCIsXCJQXCJdLFxyXG5cdHdzTU9OQUcgOiB1bmRlZmluZWQsXHJcblx0d3NSQU5HRSA6IHVuZGVmaW5lZCxcclxuXHRvcHRzTU9OQUcgOiB7XHJcblx0XHRub1plcm8gOiAhYXJncy56ZXJvLFxyXG5cdFx0c3RvcFJlY29yZHMgOiBhcmdzLnN0b3BSZWNvcmRzXHJcblx0XHR9XHJcblx0fSBhcyBIZWxwZXJzLkdlblBhcmFtcztcclxuXHRyZXR1cm4gcGFycztcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIEdlbmVyYXRlUGVyc29ucyggcGFyczogSGVscGVycy5HZW5QYXJhbXMsIG8gOiBPdXRwdXRQYXJhbXMgKSB7XHJcblx0cGFycy53c01PTkFHID0gSGVscGVycy5nZXRXUyhvLkZJTEVOQU1FX01PTkFHKTtcclxuXHRwYXJzLndzUkFOR0UgPSBIZWxwZXJzLmdldFdTKG8uRklMRU5BTUVfUkFOR0UpO1xyXG5cdEhlbHBlcnMud3JpdGVIZWFkZXIocGFycy53c01PTkFHKTtcclxuXHRIZWxwZXJzLndyaXRlSGVhZGVyKHBhcnMud3NSQU5HRSk7XHJcblx0Zm9yKHZhciBwID0gMTsgcCA8IHBhcnMuTlJQRVJTOyArK3ApIHtcclxuXHRcdHZhciBwbiA9IEhlbHBlcnMuZ2VuVXNlcihwKTtcclxuXHRcdEhlbHBlcnMuZ2VuUGVyc29uKHBuLCBwYXJzKTtcclxuXHR9XHJcblxyXG5cdHBhcnMud3NNT05BRy53cy5vbignZmluaXNoJywgKCkgPT4ge1xyXG5cdFx0Y29uc29sZS5sb2coJ1dyb3RlIGRhdGEgdG8gZmlsZSAnICsgby5GSUxFTkFNRV9NT05BRyApO1xyXG5cdFx0SGVscGVycy5jbGVhbnNlV1NDb21tZW50c1JlcGVhdGVkSGVhZGVySW5GaWxlKG8uRklMRU5BTUVfTU9OQUcsIG8uRklMRU5BTUVfTU9OQUdfQywgZnVuY3Rpb24oKSB7XHJcblx0XHRcdGNvbnNvbGUubG9nKCdXcm90ZSBjbGVhbnNlZCBmaWxlIHRvICcgKyBvLkZJTEVOQU1FX01PTkFHX0MgKTtcclxuXHRcdH0pO1xyXG5cdH0pO1xyXG5cdHBhcnMud3NSQU5HRS53cy5vbignZmluaXNoJywgKCkgPT4ge1xyXG5cdFx0Y29uc29sZS5sb2coJ1dyb3RlIGRhdGEgdG8gZmlsZSAnICsgby5GSUxFTkFNRV9SQU5HRSApO1xyXG5cdFx0SGVscGVycy5jbGVhbnNlV1NDb21tZW50c1JlcGVhdGVkSGVhZGVySW5GaWxlKG8uRklMRU5BTUVfUkFOR0UsIG8uRklMRU5BTUVfUkFOR0VfQywgZnVuY3Rpb24oKSB7XHJcblx0XHRcdGNvbnNvbGUubG9nKCdXcm90ZSBjbGVhbnNlZCBmaWxlIHRvICcgKyBvLkZJTEVOQU1FX1JBTkdFX0MgKTtcclxuXHRcdH0pO1xyXG5cdH0pO1xyXG5cclxuXHRwYXJzLndzTU9OQUcud3MuZW5kKCk7XHJcblx0cGFycy53c1JBTkdFLndzLmVuZCgpO1xyXG59XHJcblxyXG4iXX0=
